<!DOCTYPE html>
<html lang="no">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/assets/style.css">
    <title>asgadsgsd</title>
  </head>
  <body>
    <nav class="site-nav" aria-label="Hovednavigasjon">
      <div class="container nav-inner">
        <a class="brand" href="/">KimBlogg</a>
        <div class="nav-links">
          <a href="/">Hjem</a>
          <a href="/blog/">Blogg</a>
          <a href="/admin/">Admin</a>
          <a href="#" id="id-account">Konto</a>
        </div>
      </div>
    </nav>

    <main class="container prose" id="main-content">
      
  <article>
    <h1>asgadsgsd</h1>
    <p><em>Publisert: 26.08.2025</em></p>
    <p>segsdgsdgsdgsdg</p>

  </article>

    </main>

    <footer class="site-footer">
      <div class="container">© 2025 Kim Halvar Thoresen</div>
    </footer>

    <!-- Netlify Identity widget -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script>
      (function () {
        function hasToken(hash) {
          return !!hash && (hash.includes('invite_token=') || hash.includes('recovery_token='));
        }
        function openModalForHash(hash) {
          if (!hash || !window.netlifyIdentity) return;
          if (hash.includes('invite_token=')) { netlifyIdentity.open('signup'); }
          else if (hash.includes('recovery_token=')) { netlifyIdentity.open('login'); }
        }

        function initIdentity() {
          if (!window.netlifyIdentity) return;

          netlifyIdentity.init();

          // Kun logg feil til konsoll (ikke vis i UI)
          netlifyIdentity.on('error', (err) => {
            console.error('[Identity suppressed error]', err);
          });

          // Konto-lenke i nav åpner brukerpanelet
          const account = document.getElementById('id-account');
          if (account) {
            account.addEventListener('click', (e) => {
              e.preventDefault();
              netlifyIdentity.open('user');
            });
          }

          const tokenPresent = hasToken(window.location.hash);

          if (tokenPresent) {
            // Ved magic link (invite/reset):
            // Når login skjer automatisk, åpne "user"-panelet så du kan sette nytt passord
            netlifyIdentity.on('login', () => {
              // Fjern token fra URL så det ikke trigges igjen
              history.replaceState(null, '', window.location.pathname + window.location.search);
              netlifyIdentity.open('user'); // her kan du velge "Change password"
              // Merk: ingen redirect til /admin/ i dette tilfellet
            });
          } else {
            // Normal innlogging (uten token) → rett til admin
            netlifyIdentity.on('login', () => { window.location.href = '/admin/'; });
          }

          netlifyIdentity.on('logout', () => { window.location.href = '/'; });

          // Håndter innkommende token-hash
          openModalForHash(window.location.hash);
          window.addEventListener('hashchange', () => openModalForHash(window.location.hash));
        }

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initIdentity);
        } else {
          initIdentity();
        }
      })();
    </script>
  </body>
</html>
